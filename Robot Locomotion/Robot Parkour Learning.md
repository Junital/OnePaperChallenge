# Robot Parkour Learning

## 背景

人类和动物都有非常惊人的运动天赋。跑酷中包含了敏捷且灵活的动作，这需要实时的视觉感知和对周围环境的记忆、感知和动作的紧密配合与强有力的肢体来通过障碍。

跑酷对机器人腿部运动非常有挑战，需要在复杂环境中快速克服不同的障碍。现存的方法可以生成多样但是无视觉的技巧和基于视觉但是只能专项得技巧。但是，自动跑酷需要机器人学习可泛化的技巧，同时满足视觉性和多样性，以此来感知并对不同场景进行反应。

看到基于学习的方法在走路、爬楼梯、模仿动物和肢体灵活控制上有非常稳定的效果，本文想在只适用低成本硬件的情况下为机器人跑酷使用基于学习的方法。

下面是一些学习跑酷的挑战：

1. 学习不同的跑酷技巧很难：现有的强化学习需要设计复杂的、很多术语的奖励方程才能引出比较满意的结果。通常每个行为都需要认为对奖励术语和超参进行调整。因此这些方法没有办法拓展为像跑酷这样多样的任务。相比之下，直接向动物的行为进行模仿可以避免繁琐的奖励设计和优化。但是这种方法缺乏第一人称视觉数据和不同的动物动作捕捉技能，导致机器人不能学习到多样敏捷的技能和自动根据环境选择的技能。
2. 障碍物对低成本小型的机器人很有挑战性。
3. 除去学习多样性技巧的挑战，在高速运动中视觉感知会是动态且延迟的。比如，当机器人以1m/s的速度移动，那么就会有0.2秒的信号通信延迟，导致0.2米的感知延迟。并且目前的基于学习的方法并没有展示出在高速敏捷移动中的有效性。
4. 跑酷对机器人的电力马达有要求，需要达到最大容量才行。因此必须要使用能减轻马达潜在损坏的先行方法。

![Fig1](./fig/challenges%20for%20small%20robot%20to%20parkour.png)

## 跑酷学习系统

本文的目标是构建一个端到端跑酷系统，直接使用原主板深度传感和主体来控制一个低成本机器人的每个关节，从而表现不同的敏捷跑酷技能。

本文提出一个学习单一端到端基于视觉的多样跑酷技巧原则的系统，仅仅使用一个没有任何参考动作数据的奖励。本文使用直接配点的强化学习来生成跑酷技巧，包括攀爬高的障碍、跳过大间隙、匍匐过低栅栏、挤过窄裂缝和跑步。本文提取这些技巧到一个单一基于视觉的跑酷原则，并通过第一人称的深感相机将其迁移到一个四足机器人上。

本文的强化学习包含了两个模拟训练阶段：用软动力限制来预训练和用硬动力限制来微调。在预训练阶段，本文通过使用实施软动力限制的课程，允许机器人穿透障碍物。这会让机器人逐渐在减小穿透的情况下克服这些障碍。在微调阶段，本文施加了所有动力限制并用真实的动力微调预训练中学到的行为。这两个阶段，本文只使用了简单的奖励方程，促使机器人在保留机械能量的同时向前移动。每个独立的跑酷技能学到之后，本文使用DAgger来将这些技能提取到一个单一基于视觉的跑酷原则上，让机器人可以部署。为了实现在一个低成本机器人上的稳定虚转实部署，本文对深度图片使用了一些预处理的方法，校准主板视觉延迟并加入了保障马达安全先行方法。

![Fig2](./fig/parkour%20two-stage%20RL%20training.png)

### 双阶段强化学习

由于深度照片渲染成本很高，并且在视觉数据上直接训练强化学习不是很稳定，本文使用环境的特权信息来帮助强化学习在模拟中生成具体的跑酷技巧。特权视觉信息包括：从机器人目前位置到前方障碍物的距离、障碍物的高度、障碍物的宽度、四维one-hot向量表示上述四种障碍。

本文将每个具体技巧原则设计为一个GRU（门循环网络）。

## 测试

本文通过测试展示出系统可以让两个不同的低成本机器人自动选择并执行合适的跑酷技巧来穿梭于充满挑战的真实环境。
